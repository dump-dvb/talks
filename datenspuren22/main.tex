\documentclass[aspectratio=169]{beamer}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{svg}
\usepackage{todonotes}
\usepackage{siunitx}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{eurosym}
\usepackage{relsize}
\usepackage{ellipsis}

\pgfplotsset{compat=newest} % Allows to place the legend below plot
\usepgfplotslibrary{units} % Allows to enter the units nicely


\setbeamertemplate{caption}[numbered]

\title{Open Data: \\ Receive it Yourself}
\date[ISPN â€™80]{Datenspuren 2022, Dresden}
\author[]{Tassilo, 0xA, Marenz (dump@dvb.solutions)}

\usetheme{dvb}

\AtBeginSection[]{
  \begingroup
  \setbeamertemplate{background}{
    \begin{tikzpicture}
      \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
      \fill[dvbyellow,rotate around={70:(0,0)}] (0,-2) rectangle (22,0);
      \fill[dvbyellow,rotate around={70:(3,0)}] (0,-2) rectangle (22,0);
    \end{tikzpicture}
  }
  \begin{frame}
  \vskip4cm%
    \begin{beamercolorbox}[wd=12cm,leftskip=3cm]{title page header}
    	\usebeamerfont{title}\textbf{\LARGE \fontfamily{pag}\selectfont \secname}\par%
    \end{beamercolorbox}
  \vfill
  \end{frame}
  \endgroup
}

\newcommand*{\myfont}{\fontfamily{pag}\selectfont}

\makeatletter
\tikzset{
    database/.style={
        path picture={
            \draw (0, 1.5*\database@segmentheight) circle [x radius=\database@radius,y radius=\database@aspectratio*\database@radius];
            \draw (-\database@radius, 0.5*\database@segmentheight) arc [start angle=180,end angle=360,x radius=\database@radius, y radius=\database@aspectratio*\database@radius];
            \draw (-\database@radius,-0.5*\database@segmentheight) arc [start angle=180,end angle=360,x radius=\database@radius, y radius=\database@aspectratio*\database@radius];
            \draw (-\database@radius,1.5*\database@segmentheight) -- ++(0,-3*\database@segmentheight) arc [start angle=180,end angle=360,x radius=\database@radius, y radius=\database@aspectratio*\database@radius] -- ++(0,3*\database@segmentheight);
        },
        minimum width=2*\database@radius + \pgflinewidth,
        minimum height=3*\database@segmentheight + 2*\database@aspectratio*\database@radius + \pgflinewidth,
    },
    database segment height/.store in=\database@segmentheight,
    database radius/.store in=\database@radius,
    database aspect ratio/.store in=\database@aspectratio,
    database segment height=0.1cm,
    database radius=0.25cm,
    database aspect ratio=0.35,
}
\makeatother

\begin{document}

\begin{frame}\titlepage
\end{frame}
  
\begin{frame} 
 %\includesvg{dvbdump}
\frametitle{Roadmap} 
%\framesubtitle{The proof uses \textit{reductio ad absurdum}.} 

\tableofcontents

\end{frame}

% =================================================

\begin{frame}
\frametitle{Protocol}
\framesubtitle{Protocolls used in different cities}
\begin{figure}
\centering
\missingfigure[figwidth=7cm]{}
\caption{Missing figure caption}
\end{figure}
\end{frame}

% =================================================

\section{Radio \& VDV 420}

% =================================================

\begin{frame}
\frametitle{Data sources}
\framesubtitle{Overview of traffic light control (Ampelbeeinflussung)}
\begin{figure}
\centering
\includegraphics[height=0.65\textheight]{figs/lsa-beeinflussungs-stecke.pdf}
\caption{Traffic light controlled by radio link of busses and trams}
\end{figure}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Data sources}
\framesubtitle{Overview of traffic light control (Ampelbeeinflussung)}
\begin{figure}
\centering
\includegraphics[height=0.65\textheight]{figs/lsa-beeinflussungs-stecke-mit-antenne.pdf}
\caption{Radio signals can be received by our antennas}
\end{figure}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Data sources}
\framesubtitle{Receiver overview}
\begin{figure}
\centering
\includegraphics[height=0.65\textheight]{figs/antenna-filter.pdf}
\caption{Schematic overview of the receiver hardware}
\end{figure}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Protocol}
\framesubtitle{VDV 420}
	\begin{itemize}
		\item which protocol?
		\item which frequency?
		\item some background on Ampelbeeinflussung and VDV 420 / 426
		\item R09 telegrams of trams and busses standardized in \href{https://knowhow.vdv.de/documents/420/}{VDV 420}
	\end{itemize}
\end{frame}

% =================================================

\begin{frame}
\title{test}
%\frametitle{Protocol}
%\framesubtitle{VDV 420 data}
\begin{itemize}
	\item what data can we receive?
	\begin{itemize}
		\item Tram identification data: line number, run number, destination number
		\item Location data: traffic light id, direction, registration\_type
		\item and some other (delay)
	\end{itemize}
\end{itemize}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Protocol}
\framesubtitle{VDV 420 physical layer}
\begin{itemize}
	\item Minimum Shift Keying with \SI{2400}{Baud}
	\item bursty packet transmittion
		\item what frequency?
		\begin{itemize}
			\item look at the range of frequencies of RBL380, TODO add ranges
			\item take a look at our table, TODO link
			\item osint
		\end{itemize}
\end{itemize}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Protocol}
\framesubtitle{Frequency identification}
\begin{figure}
\centering
\missingfigure[figwidth=7cm]{}
\caption{Screenshot of the bursty transmittion pattern}
\end{figure}
\end{frame}

% =================================================

\begin{frame}
\frametitle{Protocol}
\framesubtitle{Physical layer used in different cities}
\begin{figure}
% https://opus4.hbz-nrw.de/opus45-bast/frontdoor/deliver/index/docId/2595/file/V353+BF+Gesamtversion.pdf
% page 25
\begin{columns}
\column{.5\linewidth}
\centering
\includegraphics[height=0.8\textheight]{figs/vcdb-map-ampelbeeinflussung.png}
\column{.5\linewidth}
\caption{Map with selected locations which have traffic lights, controlled by public transport. Blue points use the standard we implemented.}
\vspace{0.5cm}
\begin{itemize}
	\item different physical layer protocols described in VDV 426
\end{itemize}
\end{columns}
\end{figure}
\end{frame}

% =================================================

\section{Soul Extrating Information \& Mapping }

%TODO: oxa


% =================================================

\section{Architecture \& Infra }

% =================================================

\begin{frame}
  \frametitle{Operating Receivers}


\begin{figure}
\begin{columns}
\column{.5\linewidth}
\begin{center}
  \includegraphics[height=0.65\textheight]{figs/map_dresden.jpg}
  \caption{Receivers in Dresden}
\end{center}
\column{.5\linewidth}
\begin{center}
  \includegraphics[height=0.65\textheight]{figs/map_chemnitz.jpg}
  \caption{Receivers in Chemnitz}
\end{center}
\end{columns}
\end{figure}

\end{frame}

% =================================================

\begin{frame}
\frametitle{Received Data}

\begin{figure}[h!]
  \begin{center}
    \begin{tikzpicture}[scale=0.6]
      \begin{axis}[
          width=\linewidth,
          grid=major,
          grid style={dashed,gray!30},
          xlabel=Time over 4 days,
          ylabel=Telegrams in 5 minute intervals,
          %x unit=time,
          %y unit=\si{\ampere},
          %legend style={at={(0.5,-0.2)},anchor=north},
          x tick label style={rotate=90,anchor=east},
          xticklabels={,,},
          %xticklabels={day1, day2, day3, day4} TODO: make nice labels
        ]
        \addplot
        table[x=time,y=value,col sep=comma] {figs/rawdata.csv};
      \end{axis}
    \end{tikzpicture}
  \end{center}
\end{figure}


\end{frame}

% =================================================

\begin{frame}
\frametitle{Assembeling a Receiver}

\begin{figure}
\begin{columns}
\column{.5\linewidth}
\begin{center}
\includegraphics[height=0.7\textheight]{figs/station_barkhausen.jpg}
\end{center}
\column{.5\linewidth}
\raggedright
\caption{Station Barkhausenbau}
\vspace{0.5cm}

\begin{itemize}
	%\item\todo[inline]{make caption allign left}
	%\item\todo[inline]{please provide some details about this station}
  \item GDR powersuply casing (10\texteuro)
  \item Dell Wyse 3040 (70\texteuro)
  \item Rad1o Badge (e.g RTL SDR 30\texteuro)
  \item Hardware Filter (15\texteuro)
  \item Healthy amounts of kapton
\end{itemize}

$\Rightarrow$ ~130\texteuro \ per Station

\end{columns}
\end{figure}

\end{frame}

% =================================================

\begin{frame}
\frametitle{Architecture}

% Funnel
% DVB-API
% Clicky-Bunty
% Tracy

\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathreplacing,decorations.markings,shapes.geometric}
\tikzset{radiation/.style={{decorate,decoration={expanding waves,angle=90,segment length=4pt}}}}

\begin{tikzpicture}[thick,scale=0.55, every node/.style={scale=0.55}]

\input{figs/receiver.tikz}
\input{figs/architecture.tikz}
\input{figs/client.tikz}

\end{tikzpicture}

\end{frame}

%TODO: Friendship Ended with Influx

% =================================================

\begin{frame}
  \frametitle{Technical Loans}
  \framesubtitle{Lessons Learned}

\begin{figure}
\begin{columns}
\column{.5\linewidth}
\begin{center}
\includegraphics[height=0.65\textheight]{figs/meme_postgres_influx.png}
\end{center}
\column{.5\linewidth}
\raggedright
\vspace{0.5cm}

\begin{itemize}
  \item Influx Sucks
        \begin{itemize}
          \item Database dumps costed 14GBs of RAM
          \item Server died hourly
        \end{itemize}
    \item Single point of truth
    \begin{itemize}
        \item Implement Protocols in Libraries which is then used by both parties.
    \end{itemize}
    \item Hardware homogenity
\end{itemize}
\end{columns}
\end{figure}

\end{frame}


% =================================================

\section{Call for Action}

% =================================================

\begin{frame}
\frametitle{The project is huge you can help !}

\begin{itemize}
  \item Frontend
        \begin{itemize}
          \item \textbf{Tofu}: landing page (TECHNOLOGY OPEN)
          \item \textbf{Tracy}: Mapping Assitent (TECHNOLOGY OPEN)
          \item \textbf{Click}: User + Station Managment (elm-lang)
          \item \textbf{Windshield} Live Map
        \end{itemize}
  \item Setup Stations
  \item Map your City
  \item Find Frequencies
  \item Test Images on new Hardware
  \item Give us Roof Access
\end{itemize}

\end{frame}

% =================================================

\section{Questions}

\end{document}
